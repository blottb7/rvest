library(readxl)
bv <- read_excel("C:/Users/Ben/Desktop/R Projects/olympics/olympics_odds_2018.xlsx")

bv$implied_odds <- ifelse(bv$line_odds < 0,
                          -bv$line_odds / (-bv$line_odds + 100),
                         100 / (bv$line_odds + 100) )

bv1 <- bv %>%
  group_by(sport, event) %>%
  summarize(event_odds_tot = sum(implied_odds))
bv <- bv %>%
  left_join(bv1, by = c("sport", "event")) %>%
  mutate(true_odds = implied_odds / event_odds_tot)
# #checks to make sure true odds add to 1 for each event
bv_new <- bv %>%
  group_by(sport, event) %>%
  summarize(event_true_odds_tot = sum(true_odds))
rm(bv_new)

#remove line odds
bv$line_odds <- NULL

#make sport-event var
bv$sport_event <- paste(bv$sport, bv$event, sep = " ")

#event_list <- unique(c(bv$sport, bv$event))
event_list <- unique(bv$sport_event)

empty_df <- data.frame() #create empty data frame
#create for loop that runs odds_second on each sport-event group
for(i in seq_along(event_list)) {
  #run odds second on each sport event group
  new_df <- as.data.frame(odds_second(bv$true_odds[which(bv$sport_event == event_list[i])]))
  #print(new_df)
  #bind the rows of each iteration into a df object
  empty_df <- bind_rows(empty_df, new_df)
  
}

bv_new <- bind_cols(bv, empty_df)
new_df <- odds_second(bv$true_odds[which(bv$sport_event == event_list[1])])
